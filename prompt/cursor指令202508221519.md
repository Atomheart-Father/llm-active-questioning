å¥½çš„ï¼Œä¸‹é¢æ˜¯**ç»™ cursor çš„æœ¬åœ°å·¥å•**ã€‚ä½ æŠŠè¿™ä¸€æ•´æ¡æ¶ˆæ¯ä¿å­˜æˆ `CURSOR_TASK_LOCAL.md` è®©ä»–ç…§åšå³å¯ï¼›å…¶ä¸­å«æœ‰**ä¸€é”®è„šæœ¬**ã€**Makefile ç›®æ ‡**ã€**é…ç½®è¡¥ä¸**å’Œ**å¤±è´¥ä¸ŠæŠ¥æ¸…å•**ã€‚æ‰€æœ‰å‘½ä»¤å‡ä¸º**å¯ç›´æ¥å¤åˆ¶æ‰§è¡Œ**ï¼Œå¹¶å†…ç½®**æ–­ç‚¹ç»­è®­**ä¸**æ—¥å¿—ç•™å­˜/æŠ¥é”™ä¸ŠæŠ¥**æœºåˆ¶ã€‚

---

# **ç»™ cursor çš„å·¥å•ï¼ˆæœ¬åœ°ï¼‰**

**ä¸»é¢˜ï¼šRC1 å¼€è·‘å‰â€œäºŒè½®é¢„æ£€ \+ æ–­ç‚¹ç»­è®­ \+ æŠ¥é”™ä¸ŠæŠ¥â€å…¨æµç¨‹**

## **0\) å¼ºåˆ¶è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰**

* **ä¸¥ç¦**åœ¨é¢„æ£€æœªé€šè¿‡æ—¶å¯åŠ¨è®­ç»ƒï¼›åªæœ‰å½“ `reports/preflight/round2_pass.json` å­˜åœ¨æ—¶æ‰å¯æ‰§è¡Œè®­ç»ƒã€‚  
* **ä»»ä½•æŠ¥é”™ç«‹åˆ»åœæ­¢**å¹¶ä¸ŠæŠ¥ï¼ˆè§æ–‡æœ«â€œå¤±è´¥ä¸ŠæŠ¥æ¸…å•â€ï¼‰ï¼›ä¸å¾—ç§è‡ªæ”¹æŒ‡æ ‡ã€åˆ æ—¥å¿—ã€‚  
* **å…¨éƒ¨å‘½ä»¤åœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œ**ï¼›è‹¥å‘½ä»¤æç¤ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±æŒ‰â€œéœ€è¦ä½ åˆ›å»ºçš„æ–‡ä»¶ä¸è„šæœ¬â€ä¸€èŠ‚åˆ›å»ºã€‚

---

## **1\) ä¸€é”®è„šæœ¬ï¼ˆåˆ›å»ºå¹¶è¿è¡Œï¼‰**

æŠŠä¸‹é¢å†…å®¹ç²˜è´´ä¸º `ops/run_local_rc1.sh`ï¼ˆå¦‚æ—  `ops/` ç›®å½•å…ˆåˆ›å»ºï¼‰ï¼Œç„¶åæ‰§è¡Œï¼š

mkdir \-p ops && nano ops/run\_local\_rc1.sh  
\# ç²˜è´´å®Œæ¯•åï¼š  
chmod \+x ops/run\_local\_rc1.sh  
./ops/run\_local\_rc1.sh

**`ops/run_local_rc1.sh` å†…å®¹ï¼š**

\#\!/usr/bin/env bash  
set \-euo pipefail

\# \============ åŸºæœ¬ç¯å¢ƒ \============  
export PYTHONUNBUFFERED=1  
export RUN\_MODE=prod  
export BASE\_MODEL="${BASE\_MODEL:-Qwen/Qwen3-4B-Thinking-2507}"  
export SCORER\_PROVIDER="${SCORER\_PROVIDER:-gemini}"   \# å¯é€‰ï¼šgemini / deepseek\_r1 / openai ç­‰  
: "${SCORER\_API\_KEY:?è¯·å…ˆ export SCORER\_API\_KEY=ä½ çš„çœŸå®Key}"

\# ç›®å½•å°±ç»ª  
mkdir \-p logs reports/preflight reports/rc1 data/rollouts checkpoints/rc1/best templates/pack\_v2

\# å…¨å±€æ—¥å¿—ç®¡é“ï¼šæ‰€æœ‰ stdout/stderr è¿›å…¥æ€»æ—¥å¿— \+ å±€éƒ¨æ—¥å¿—  
exec \> \>(tee \-a "logs/ops\_$(date \+%Y%m%d\_%H%M%S).log") 2\>&1

\# é”™è¯¯é™·é˜±ï¼šä¸€æ—¦å‡ºé”™ï¼Œæ‰“åŒ…å…³é”®ä¿¡æ¯ç”¨äºä¸ŠæŠ¥  
on\_error () {  
  echo "ğŸš¨ å‘ç”Ÿé”™è¯¯ï¼Œæ­£åœ¨æ”¶é›†æœ€å200è¡Œæ—¥å¿—ä¸å…³é”®äº§ç‰©â€¦â€¦"  
  tail \-n 200 logs/\*.log || true  
  tar \-czf "reports/rc1/FAIL\_$(date \+%Y%m%d\_%H%M%S).tgz" \\  
    logs \\  
    reports/preflight || true  
  echo "âŒ å¤±è´¥å½’æ¡£å·²ç”Ÿæˆï¼šreports/rc1/FAIL\_\*.tgz"  
}  
trap on\_error ERR

\# \============ 1\. Python ç¯å¢ƒä¸ä¾èµ– \============  
if \! command \-v python3 \>/dev/null; then echo "âŒ ç¼ºå°‘ python3"; exit 2; fi  
PYVER=$(python3 \- \<\<'PY'  
import sys  
print(f"{sys.version\_info.major}.{sys.version\_info.minor}")  
PY  
)  
echo "Python version: $PYVER"  
python3 \-m venv .venv  
source .venv/bin/activate  
python \-m pip install \-U pip wheel  
if \[ \-f requirements.txt \]; then  
  pip install \-r requirements.txt  
else  
  \# æœ€ä½ä¾èµ–å…œåº•ï¼ˆæŒ‰é¡¹ç›®éœ€è¦å¢è¡¥ï¼‰  
  pip install "torch\~=2.3" "transformers\>=4.42" "datasets\>=2.19" \\  
              "trl\>=0.9" "peft\>=0.11" "accelerate\>=0.33" "evaluate\>=0.4" \\  
              "tqdm" "numpy" "scikit-learn" "pyyaml" "jsonlines" "jinja2"  
fi

\# \============ 2\. Git æŒ‡çº¹ï¼ˆå¯å®¡è®¡ï¼‰ \============  
git rev-parse \--is-inside-work-tree \>/dev/null 2\>&1 && {  
  git status \--porcelain \> reports/rc1/git\_status.txt || true  
  git rev-parse HEAD \> reports/rc1/git\_commit.txt || true  
}

\# \============ 3\. èµ„æºæ£€æŸ¥ \============  
python \- \<\<'PY'  
import shutil, os  
free\_gb \= shutil.disk\_usage(".").free/2\*\*30  
assert free\_gb\>50, f"ç£ç›˜ä¸è¶³ï¼š{free\_gb:.1f}GBï¼Œè‡³å°‘éœ€\>50GB"  
print(f"DISK\_OK {free\_gb:.1f}GB å¯ç”¨")  
PY

\# \============ 4\. è¯„åˆ†å™¨çœŸè¿é€š \+ é˜²æ¨¡æ‹Ÿ \============  
\# 4.1 æ¢é’ˆï¼šå¿…é¡»æœ‰çœŸå®å»¶è¿Ÿä¸å¯è®¡è´¹è°ƒç”¨  
python scripts/probe\_scorer.py \--n 8 \--provider "$SCORER\_PROVIDER" \--live

\# 4.2 é˜²ä¼ªï¼šç¼“å­˜å‘½ä¸­ç‡é¦–è½®å¿…é¡» \< 90%  
python scripts/assert\_not\_simulated.py \--cache\_hit\_lt 0.90

\# \============ 5\. å½±å­è¯„æµ‹é›†ç‰©åŒ– \============  
python \-m src.evaluation.shadow\_run \--n 245 \--seed 20250820 \--stratify \\  
  \--materialize data/shadow\_eval\_245.jsonl \\  
  \--dump-manifest reports/rc1/sample\_manifest.json  
sha256sum data/shadow\_eval\_245.jsonl \> reports/rc1/shadow\_eval\_245.sha256

\# \============ 6\. æ„å»ºç§å­æ± ï¼ˆæŒ‰éœ€è°ƒæ•´nä¸é…æ¯”ï¼‰ \============  
python scripts/build\_rollout\_pool.py \\  
  \--out data/rollouts/rc1\_seed.jsonl \\  
  \--n 30000 \\  
  \--mix "hotpotqa:0.45,strategyqa:0.30,gsm8k:0.25" \\  
  \--max\_turns 6 \--clarify\_rate 0.30 \\  
  \--tools "wiki,calc" \\  
  \--templates\_dir templates/pack\_v2

\# \============ 7\. å¤šæ ·æ€§ä½“æ£€ï¼ˆæ‰©é‡å‰é—¸é—¨ï¼‰ \============  
python scripts/validate\_pool.py data/rollouts/rc1\_seed.jsonl \\  
  \--min\_distinct2 0.60 \--kl3\_min 0.15 \--roles\_min 4 \--styles\_min 3 \\  
  \--max\_dup\_pct 2.0 \--max\_len 4096 \--min\_len 64 \\  
  \--leak\_check data/shadow\_eval\_245.jsonl \--leak\_ngram 5 \--leak\_sim 0.85 \\  
  \--by\_task "hotpotqa,strategyqa,gsm8k"  
sha256sum data/rollouts/rc1\_seed.jsonl \> reports/rc1/rc1\_seed.sha256

\# \============ 8\. éš¾åº¦æŒ‡æ ‡ â†’ åˆ†æ¡¶ â†’ å¹³è¡¡åˆ†å¸ƒ \============  
python scripts/difficulty\_metrics.py \\  
  \--in data/rollouts/rc1\_seed.jsonl \\  
  \--out data/rollouts/rc1\_seed.metrics.jsonl

python scripts/difficulty\_bucketize.py \\  
  \--metrics data/rollouts/rc1\_seed.metrics.jsonl \\  
  \--target "easy:0.25,medium:0.45,hard:0.30" \\  
  \--by\_task "hotpotqa,strategyqa,gsm8k" \\  
  \--out data/rollouts/rc1\_seed.balanced.jsonl

python scripts/validate\_difficulty.py \\  
  \--metrics data/rollouts/rc1\_seed.metrics.jsonl \\  
  \--balanced data/rollouts/rc1\_seed.balanced.jsonl \\  
  \--min\_hard\_pct 0.30 \--max\_easy\_pct 0.30 \\  
  \--len\_max 3500 \--turns\_max 8 \--tool\_hops\_max 8 \\  
  \--clue\_overlap\_max\_easy 0.65 \--clue\_overlap\_min\_hard 0.10 \\  
  \--out reports/rc1/difficulty\_report.json

sha256sum data/rollouts/rc1\_seed.metrics.jsonl \> reports/rc1/rc1\_seed.metrics.sha256  
sha256sum data/rollouts/rc1\_seed.balanced.jsonl \> reports/rc1/rc1\_seed.balanced.sha256

\# \============ 9\. æƒé‡æ–‡ä»¶ä¸æƒ©ç½šå¼€å…³ä½“æ£€ \============  
test \-f configs/weights.json || (echo "ç¼ºå°‘ configs/weights.json" && exit 2\)  
python \- \<\<'PY'  
import json,hashlib  
w=json.load(open("configs/weights.json"))  
wsum=sum(w\["weights"\].values())  
assert abs(wsum-1.0)\<1e-6, "weights æœªå½’ä¸€åŒ–"  
assert max(w\["weights"\].values())\<=0.5+1e-9, "å­˜åœ¨å•ç»´\>0.5"  
assert all(v\>=0 for v in w\["weights"\].values()), "å‡ºç°è´Ÿæƒé‡"  
print("WEIGHTS\_OK",hashlib.sha256(open("configs/weights.json","rb").read()).hexdigest())  
PY

grep \-q "use\_overclar\_penalty: true" configs/ppo\_scale.yaml || (echo "æœªå¯ç”¨è¿‡åº¦æ¾„æ¸…æƒ©ç½š(use\_overclar\_penalty)" && exit 2\)  
pytest \-q tests/test\_overclar\_penalty.py

\# \============ 10\. Round 1 æŠ¥å‘Šèšåˆ \============  
python \- \<\<'PY'  
import json,hashlib,datetime  
def sha(p):  
  import pathlib,hashlib  
  try: return hashlib.sha256(open(p,"rb").read()).hexdigest()  
  except: return None  
r={"round":"round1","ts":datetime.datetime.utcnow().isoformat()+"Z","pass":True}  
r\["files"\]={  
  "shadow\_eval":"data/shadow\_eval\_245.jsonl",  
  "shadow\_eval\_sha":sha("data/shadow\_eval\_245.jsonl"),  
  "seed\_pool":"data/rollouts/rc1\_seed.jsonl",  
  "seed\_pool\_sha":sha("data/rollouts/rc1\_seed.jsonl"),  
  "seed\_pool\_balanced":"data/rollouts/rc1\_seed.balanced.jsonl",  
  "seed\_pool\_balanced\_sha":sha("data/rollouts/rc1\_seed.balanced.jsonl"),  
  "weights":"configs/weights.json",  
  "ppo\_cfg":"configs/ppo\_scale.yaml",  
}  
open("reports/preflight/round1.json","w").write(json.dumps(r,indent=2))  
print("PRE-R1-REPORT: reports/preflight/round1.json")  
PY

\# \============ 11\. Round 2 å¤æ ¸ï¼ˆæ›´æ¥è¿‘å®æˆ˜å£å¾„ï¼‰ \============  
\# 11.1 é˜²ä¼ªï¼šç¼“å­˜å‘½ä¸­é˜ˆå€¼æ”¾å®½åˆ° \<95%  
python scripts/assert\_not\_simulated.py \--cache\_hit\_lt 0.95

\# 11.2 ä»¥å½“å‰æƒé‡/æƒ©ç½šå£å¾„å†è·‘ä¸€æ¬¡å½±å­æ£€æŸ¥ï¼ˆå¸¦ tagï¼‰  
python \-m src.evaluation.shadow\_run \--n 245 \--seed 20250820 \--stratify \--tag "pre\_run\_check"

\# 11.3 ç”Ÿæˆ Round 2 é€šè¿‡ç¥¨  
python \- \<\<'PY'  
import json,datetime,os  
r={"round":"round2","ts":datetime.datetime.utcnow().isoformat()+"Z","pass":True}  
open("reports/preflight/round2\_pass.json","w").write(json.dumps(r,indent=2))  
print("PRE-R2-REPORT: reports/preflight/round2\_pass.json")  
PY

\# \============ 12\. åªæœ‰é€šè¿‡åæ‰å…è®¸å¯åŠ¨è®­ç»ƒ \============  
test \-f reports/preflight/round2\_pass.json || (echo "é¢„æ£€æœªé€šè¿‡ï¼šç¦æ­¢å¼€è·‘" && exit 2\)

\# æ¥å…¥éš¾åº¦æ„ŸçŸ¥é‡‡æ ·  
if \! grep \-q 'seed\_pool: "data/rollouts/rc1\_seed.balanced.jsonl"' configs/ppo\_scale.yaml; then  
  echo "âš ï¸ ä½ å°šæœªå°† balanced ç§å­æ± å†™å…¥ configs/ppo\_scale.yamlï¼šseed\_pool: \\"data/rollouts/rc1\_seed.balanced.jsonl\\""  
  echo "âš ï¸ priority\_sampling.by\_difficulty å»ºè®® {easy:0.2, medium:0.4, hard:0.4}"  
fi

\# è®­ç»ƒå¯åŠ¨ï¼ˆæ–­ç‚¹ç»­è®­ï¼šå¦‚éœ€æ¢å¤ï¼ŒåŠ  \--resume-from checkpoints/rc1/latest ï¼‰  
python \-m train.ppo\_runner \--config configs/ppo\_scale.yaml | tee \-a logs/train.log

---

## **2\) éœ€è¦ä½ åˆ›å»ºçš„æ–‡ä»¶ä¸è„šæœ¬ï¼ˆè‹¥ä»“åº“æ²¡æœ‰ï¼‰**

è‹¥ä»¥ä¸‹è„šæœ¬/æµ‹è¯•æ–‡ä»¶åœ¨ä»“åº“ä¸­ä¸å­˜åœ¨ï¼Œè¯·æ–°å»ºå¯¹åº”ç©ºä½æˆ–æŒ‰éœ€å®ç°ã€‚**å‘½åä¸è·¯å¾„å¿…é¡»ä¸€è‡´**ï¼Œä»¥ä¾¿ä¸€é”®è„šæœ¬å¯ç›´æ¥è°ƒç”¨ã€‚

1. **éš¾åº¦ç›¸å…³è„šæœ¬**  
* `scripts/difficulty_metrics.py`  
* `scripts/difficulty_bucketize.py`  
* `scripts/validate_difficulty.py`

è¿™äº›è„šæœ¬åº”å®Œæˆï¼šä»æ ·æœ¬ä¸­æŠ½å–éš¾åº¦ç‰¹å¾ï¼ˆé•¿åº¦ã€è½®æ¬¡ã€å·¥å…·è·³æ•°ã€å®ä½“æ•°ã€æ•°å€¼è¿ç®—æ­¥ã€è¿æ¥è¯å¯†åº¦ã€clue\_overlap ç­‰ï¼‰ï¼Œè¾“å‡º `*.metrics.jsonl`ï¼›æŒ‰ç›®æ ‡åˆ†å¸ƒé‡é‡‡æ ·ç”Ÿæˆ `rc1_seed.balanced.jsonl`ï¼›å¹¶åœ¨ `validate_difficulty.py` ä¸­æ ¡éªŒåˆ†å¸ƒï¼ˆHard â‰¥30%ã€Easy â‰¤30%ï¼Œå¹¶ç”Ÿæˆç›´æ–¹å›¾/åˆ†ä½æ•°/ä»»åŠ¡æ‹†åˆ†è®¡æ•°çš„ `reports/rc1/difficulty_report.json`ï¼‰ã€‚

2. **è¯„åˆ†æ¢é’ˆä¸é˜²ä¼ªè„šæœ¬**  
* `scripts/probe_scorer.py`ï¼šæ¥å— `--n --provider --live`ï¼ŒéªŒè¯**çœŸå®**æ‰“åˆ†ï¼ˆå­˜åœ¨å¯è®¡è´¹è°ƒç”¨ä¸éé›¶å»¶è¿Ÿï¼‰ã€‚  
* `scripts/assert_not_simulated.py`ï¼šæ¥å— `--cache_hit_lt <é˜ˆå€¼>`ï¼Œè‹¥è¿‘æœŸå‘½ä¸­ç‡ â‰¥ é˜ˆå€¼åˆ™é€€å‡º 2ã€‚  
3. **å½±å­è¿è¡Œä¸è¯„ä¼°**  
* `src/evaluation/shadow_run.py`ï¼šæ”¯æŒ `--n --seed --stratify [--materialize PATH] [--tag LABEL]`ï¼›äº§å‡º `reports/shadow_run_*.json`ï¼Œå­—æ®µåº”å« `spearman, kendall_tau, top10_overlap, top20_overlap, corr_to_success_old/new, corr_improve_pct`ã€‚  
* æ—§/æ–°è¯„åˆ†å™¨ä¿æŒå¹¶è¡Œå¯ç”¨ï¼›å¯¹æ–¹å·®\>0.08 çš„æ ·æœ¬åšâ€œunstableâ€æ ‡è®°å¹¶å‰”é™¤/é™æƒã€‚  
4. **è¿‡åº¦æ¾„æ¸…æƒ©ç½š**  
* `tests/test_overclar_penalty.py`ï¼šè¦†ç›– 3 æ¡ç”¨ä¾‹ï¼ˆä¸è§¦å‘ã€c=1/2/5ã€`needs_clarification=true`ï¼‰å…¨éƒ¨é€šè¿‡ã€‚

åœ¨ `configs/ppo_scale.yaml` ä¸­**å¿…é¡»**åŒ…å«ï¼š  
use\_overclar\_penalty: true

* è®­ç»ƒèšåˆå‰å°† `penalty = alpha * min(c, cap)` è®¡å…¥ä¸»å¥–åŠ±ï¼ˆå»ºè®® `alpha=0.07, cap=3`ï¼‰ã€‚

---

## **3\) æ–­ç‚¹ç»­è®­ä¸äº§ç‰©ç•™å­˜ï¼ˆå¼ºçº¦æŸï¼‰**

* **æ£€æŸ¥ç‚¹**ï¼šè®­ç»ƒè„šæœ¬æ¯ N stepï¼ˆä¾‹å¦‚ 1000ï¼‰ä¿å­˜åˆ° `checkpoints/rc1/step_XXXXX/`ï¼›æœ€æ–°è½¯é“¾æ¥ `checkpoints/rc1/latest`ã€‚  
* **æœ€ä½³æƒé‡**ï¼šæ¯æ¬¡é˜¶æ®µè¯„æµ‹é€šè¿‡ï¼Œå°±å¤åˆ¶åˆ° `checkpoints/rc1/best/`ï¼ˆåªå¢ä¸æ”¹ï¼‰ã€‚  
* **æ—¥å¿—**ï¼š  
  * è¿‡ç¨‹æ—¥å¿—ï¼š`logs/train.log`ï¼ˆ`tee -a` æ–¹å¼æŒç»­å†™å…¥ï¼‰ã€‚  
  * æŒ‡æ ‡/æŠ¥å‘Šï¼šç»Ÿä¸€è½åœ¨ `reports/`ï¼ˆåŒ…æ‹¬å¤šæ ·æ€§ã€éš¾åº¦ã€å½±å­è¿è¡Œã€æƒé‡æ ¡å‡†ã€æ¶ˆèå®éªŒï¼‰ã€‚

**æ¢å¤**ï¼šä¸­æ–­åç”¨  
python \-m train.ppo\_runner \--config configs/ppo\_scale.yaml \--resume-from checkpoints/rc1/latest

*   
* **æ•°æ®æŒ‡çº¹**ï¼šæ‰€æœ‰å…³é”® JSON/æƒé‡/é…ç½®å‡è®¡ç®— `sha256sum` è½ç›˜åˆ° `reports/rc1/*.sha256`ã€‚

---

## **4\) Makefileï¼ˆå¯é€‰ä½†å¼ºçƒˆå»ºè®®ï¼‰**

è‹¥ä½ ä½¿ç”¨ Make é©±åŠ¨ï¼ŒæŠŠä¸‹é¢ä¿å­˜ä¸º `Makefile`ï¼Œæ–¹ä¾¿å¿«é€Ÿæ‰§è¡Œä¸é‡å¤ä¸ŠæŠ¥ã€‚

.PHONY: preflight round1 round2 train resume failpack

preflight:  
\\t./ops/run\_local\_rc1.sh

round1:  
\\tpython \-m src.evaluation.shadow\_run \--n 245 \--seed 20250820 \--stratify \--materialize data/shadow\_eval\_245.jsonl \--dump-manifest reports/rc1/sample\_manifest.json  
\\tpython scripts/build\_rollout\_pool.py \--out data/rollouts/rc1\_seed.jsonl \--n 30000 \--mix "hotpotqa:0.45,strategyqa:0.30,gsm8k:0.25" \--max\_turns 6 \--clarify\_rate 0.30 \--tools "wiki,calc" \--templates\_dir templates/pack\_v2  
\\tpython scripts/validate\_pool.py data/rollouts/rc1\_seed.jsonl \--min\_distinct2 0.60 \--kl3\_min 0.15 \--roles\_min 4 \--styles\_min 3 \--max\_dup\_pct 2.0 \--max\_len 4096 \--min\_len 64 \--leak\_check data/shadow\_eval\_245.jsonl \--leak\_ngram 5 \--leak\_sim 0.85 \--by\_task "hotpotqa,strategyqa,gsm8k"

round2:  
\\tpython scripts/assert\_not\_simulated.py \--cache\_hit\_lt 0.95  
\\tpython \-m src.evaluation.shadow\_run \--n 245 \--seed 20250820 \--stratify \--tag "pre\_run\_check"  
\\tpython \- \<\<'PY'\\nimport json,datetime; open("reports/preflight/round2\_pass.json","w").write(json.dumps({"round":"round2","ts":datetime.datetime.utcnow().isoformat()+"Z","pass":True},indent=2))\\nprint("PRE-R2-REPORT: reports/preflight/round2\_pass.json")\\nPY

train:  
\\ttest \-f reports/preflight/round2\_pass.json || (echo "é¢„æ£€æœªé€šè¿‡ï¼šç¦æ­¢å¼€è·‘" && exit 2\)  
\\tpython \-m train.ppo\_runner \--config configs/ppo\_scale.yaml | tee \-a logs/train.log

resume:  
\\ttest \-f checkpoints/rc1/latest || (echo "æ—  latest æ£€æŸ¥ç‚¹" && exit 2\)  
\\tpython \-m train.ppo\_runner \--config configs/ppo\_scale.yaml \--resume-from checkpoints/rc1/latest | tee \-a logs/train.log

failpack:  
\\ttar \-czf reports/rc1/FAIL\_$(shell date \+%Y%m%d\_%H%M%S).tgz logs reports/preflight || true

---

## **5\) è®­ç»ƒé…ç½®è¡¥ä¸ï¼ˆæ ¸å¯¹è¦ç‚¹ï¼‰**

åœ¨ `configs/ppo_scale.yaml` ä¸­åº”è‡³å°‘åŒ…å«/æ ¡éªŒä»¥ä¸‹å…³é”®é¡¹ï¼ˆè‹¥æ— è¯·è¡¥ï¼‰ï¼š

simulate: false  
live\_mode: true  
base\_model: "Qwen/Qwen3-4B-Thinking-2507"  
seed\_pool: "data/rollouts/rc1\_seed.balanced.jsonl"  
priority\_sampling:  
  enable: true  
  by\_difficulty: {easy: 0.2, medium: 0.4, hard: 0.4}  
  low\_perf\_cap: 0.30  
  seed\_ratio\_schedule:  
    \- {step: 0, ratio: 0.50}  
    \- {step: 20000, ratio: 0.35}  
    \- {step: 40000, ratio: 0.20}  
use\_overclar\_penalty: true  
target\_kl: 0.02  \# å¯åœ¨ 0.02\~0.05 ä¹‹é—´å¾®è°ƒ  
steps: 50000     \# \< 50k æ‹’ç»å¼€è·‘  
seeds: \[20250820, 20250821, 20250822\]  
finetune:  
  method: qlora

---

## **6\) å¤±è´¥ä¸ŠæŠ¥æ¸…å•ï¼ˆå‡ºé”™å¿…é¡»å›ä¼ ï¼‰**

**ä»…å½“ä»»ä¸€æ­¥éª¤å¤±è´¥æ—¶**ï¼ŒæŠŠä»¥ä¸‹æ–‡ä»¶æ‰“åŒ…ï¼ˆè„šæœ¬å·²è‡ªåŠ¨ç”Ÿæˆ tar åŒ…ï¼‰å¹¶å›ä¼ ç»™è€æ¿/æ¶æ„å¸ˆå¤ç›˜ï¼š

* `reports/rc1/FAIL_*.tgz`ï¼ˆé‡Œé¢åŒ…å« `logs/` ä¸ `reports/preflight/`ï¼‰  
* ä»¥ä¸‹è‹¥å­˜åœ¨ä¹Ÿä¸€å¹¶é™„ä¸Šï¼š  
  * `data/shadow_eval_245.jsonl`ï¼ˆåŠ `*.sha256`ï¼‰  
  * `data/rollouts/rc1_seed*.jsonl`ï¼ˆåŠ `*.sha256`ï¼‰  
  * `reports/rc1/difficulty_report.json`  
  * `reports/shadow_run_*.json`  
  * `reports/calibration_report_*.json`ã€`configs/weights.json`  
  * `configs/ppo_scale.yaml`  
  * `logs/train.log`ï¼ˆè‹¥å·²å¯åŠ¨è¿‡è®­ç»ƒï¼‰

---

## **7\) éªŒæ”¶é—¨æ§›ï¼ˆä½ è‡ªæ£€é¡¹ï¼‰**

* **å¤šæ ·æ€§**ï¼š`distinct-2 â‰¥ 0.60`ã€`3-gram KL â‰¥ 0.15`ã€è§’è‰²â‰¥4ã€è¯­ä½“â‰¥3ï¼›å½±å­é›†**æ— æ³„æ¼**ã€‚  
* **éš¾åº¦åˆ†å¸ƒ**ï¼ˆæŒ‰ä»»åŠ¡é€é¡¹æ ¸å¯¹ï¼‰ï¼šHard â‰¥30%ï¼ŒEasy â‰¤30%ã€‚  
* **é˜²ä¼ª**ï¼šé¦–è½®ç¼“å­˜å‘½ä¸­ç‡ \<90%ï¼Œå¤æ ¸ \<95%ï¼›æ¢é’ˆæ˜¾ç¤º**çœŸå®**å»¶è¿Ÿä¸”å¯è®¡è´¹ã€‚  
* **æƒé‡æ–‡ä»¶**ï¼šå­˜åœ¨ã€éè´Ÿã€å½’ä¸€ã€å•ç»´ â‰¤0.5ï¼›`use_overclar_penalty: true` ä¸”å•æµ‹é€šè¿‡ã€‚  
* **è®­ç»ƒ**ï¼šåªæœ‰å½“ `reports/preflight/round2_pass.json` å­˜åœ¨æ—¶æ‰å¯å¯åŠ¨ã€‚

---

### **ä¸€å¥è¯æ€»ç»“ç»™ cursor**

å…ˆè·‘ `./ops/run_local_rc1.sh`ã€‚**ä»»ä½• FAIL ä¸è®¸ç¡¬ä¸Š**ï¼Œæ‰“åŒ… `reports/rc1/FAIL_*.tgz` å›æŠ¥ï¼›**åªæœ‰**ç”Ÿæˆ `reports/preflight/round2_pass.json` åï¼Œæ‰å…è®¸æ‰§è¡Œè®­ç»ƒå‘½ä»¤ã€‚

