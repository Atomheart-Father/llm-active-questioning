\# 项目进展（接班摘要）— 2025-09-05

\> 用途：让新对话/新成员“一眼接班”。本摘要覆盖过去两天的关键决策、当前所处 WBS 阶段、遗留问题与下一步行动，以及稳定的协作/运行规则。

\#\# 1\. 两日概览  
\- \*\*战略不变\*\*：代码只是工具；核心在\*\*数据/策略/论文\*\*。当前冲刺目标：累计 ≥ \*\*5,000\*\* 条 ALC/AR/RSD 高质量样本（训练/验证拆分）。  
\- \*\*运行形态\*\*：从本地 CLI 转为 \*\*Colab 一键跑\*\*（多密钥池 \+ 跨 Provider Fail-Over），产物仅输出 \*\*\`artifacts\_review/\*\*\`\*\* 供审阅；生成数据与临时文件不入库。  
\- \*\*关键修复\*\*：  
  \- \*\*超时与 5xx\*\*：流式/心跳、指数退避、熔断、跨 Provider Fail-Over。  
  \- \*\*JSON-only \+ Schema v1.1\*\*：禁止礼貌语/Markdown/思维链；\`model\_target\` 仅 1 个控制符（\`\<ASK\>\`/\`\<FINAL\>\`）；\`turns\` 不得为空。  
  \- \*\*MAX\_TOKENS 自适应\*\*：ALC 768 / RSD 1024 / AR 1536；触发后单条升配 ≤ 3072。  
  \- \*\*多密钥轮换\*\*：Gemini ×3、DeepSeek ×2；429/403/配额触顶自动切换。  
  \- \*\*增量落盘\*\*：partial → 合并，降低长任务中断损失。

\#\# 2\. 我们在 WBS 上的位置  
\- 当前位于 \*\*阶段 2：数据集构建\*\*（目标：到 \*\*2025-09-08\*\* 完成 \~5,000 条可用样本）。  
\- 后续里程碑（规划不变）：\*\*SFT 9-10 → Alpha 9-11 → PPO 9-14 → Beta 9-15 → GA 9-17\*\*。

\#\# 3\. 近两日可核查成果（PR 足迹）  
\- \*\*\#43\*\*：合并冲突解决；引入流式客户端、Schema 校验与微批恢复脚手架。  
\- \*\*\#45\*\*：Hotfix（超时/熔断/Fail-Over、JSON-only、自适应长度）。  
\- \*\*\#46–\#48\*\*：Notebook 路线尝试 → 发现空壳风险 → 决策转 \*\*Colab 一键\*\*。  
\- \*\*\#49\*\*：\`feat/colab-oneclick\`（脚本 \+ 入口）：支持多密钥池、Fail-Over、质量报告与审阅目录规范。

\#\# 4\. 当前遗留问题与缓解  
\- \*\*Provider 稳定性\*\*：DeepSeek 偶发空闲超时；Gemini 偶发 400/Schema。→ 采用流式 \+ 自愈解析 \+ 升配 \+ 多密钥轮换 \+ 跨 Provider Fail-Over。  
\- \*\*JSON 结构波动\*\*：个别样本 \`turns\` 为空/多控制符。→ 生成端 JSON-only，解析端“最大 JSON 抽取 → 最小补全 → 重生”，并用质量门剔除。  
\- \*\*ALC 多样性\*\*：持续监控礼貌语污染与 \`\<ASK\>\` 句式 Distinct-2，必要时做句式微改写配方。  
\- \*\*报告口径\*\*：\`quality\_review\_report.md\` 的 Fail-Over/配额分 Provider/Key 细化在放量过程中逐步完善。

\#\# 5\. 协作模式（固定约定）  
\- \*\*老板（Owner）\*\*：只在 Colab 跑；把\*\*报错原文\*\*贴到会话。我给最小补丁与参数；达标后继续放量，直到 ≥5,000。  
\- \*\*架构师\*\*：收错→定位→给方案；拆小 PR；审核 \`artifacts\_review/\*\*\`；维护质量门与节奏。  
\- \*\*Cursor（开发）\*\*：只做脚本/入口/修复与合 PR；\*\*不运行长任务\*\*；任何 WBS/Schema 变更先提案获批。

\#\#\# 对 Cursor 的硬性规则  
1\) \*\*不跑长任务\*\*：调接口批量、训练、≥10 条评审/批评测统统禁止在 CLI 跑；只交付 \*\*Colab 脚本/入口\*\*。    
2\) \*\*命令行安全\*\*：禁止长 Python；卡死立刻重启；仅允许 ≤1 分钟短校验（env/sanity/data-check/unit tests）。    
3\) \*\*并发红线\*\*：未经批准禁止 ≥20 并发；默认 ≤4。    
4\) \*\*Schema v1.1\*\*：\`turns\[\].role∈{user,model\_target,assistant}\`；\`model\_target\` 仅 1 个控制符；禁礼貌语/Markdown/思维链；RSD 只记 \`reasoning.actions\`。    
5\) \*\*JSON-only\*\*：Gemini 优先 \`response\_schema+application/json\`；DeepSeek 用 JSON-only 提示 \+ 停止序列；失败记录 \`provenance.failover\`。    
6\) \*\*长度与超时\*\*：自适应上限（ALC 768 / RSD 1024 / AR 1536；单条升配 ≤3072）；\`idle=90s / read=240s / connect=10s\`；流式落盘。    
7\) \*\*产物与提交流程\*\*：仅 \*\*\`artifacts\_review/\*\*\`\*\* 入库（summary/quality/samples/cost）；\`data/gen/\`、\`runs/\`、\`reports/\` 一律忽略；每个 PR 带四件套 \+ 5 条抽检。    
8\) \*\*WBS 对齐\*\*：不得私改；阶段/字段变更先提案获批。

\#\# 6\. 日常执行清单（两次/日）  
1\) 在 Colab 运行“一键单元格（多 Key 版）”：初始 \*\*4/3/3\*\* 冒烟。    
2\) 仅提交 \*\*review-only PR\*\*：\`artifacts\_review/\*\*\` \+ 5 条抽检样本。    
3\) 审阅→给出“放量/修复点/参数微调”。    
4\) 循环执行，直至样本累计 ≥ \*\*5,000\*\*（完成本阶段交付）。

\#\# 7\. 本轮放量门槛（批次验收）  
\- Schema 合规 ≥ \*\*90%\*\*；\`turns\` 非空；单控制符；无礼貌语/Markdown；    
\- \`MAX\_TOKENS=0\`（触发则单条升配后复跑该条）；    
\- ALC：ASK ≥95%、Over-asking ≤10%、Distinct-2 ≥0.85；    
\- AR（若走 flash 生成）：F1 ≥0.7、InfoGain@1 ≥0.8；    
\- Fail-Over 记录完备（from→to、原因码、时间）。

\> 注：一键运行入口与脚本见 PR \#49（\`feat/colab-oneclick\`）。Owner 在 Colab 侧执行；Cursor 仅维护脚本与合 PR。

